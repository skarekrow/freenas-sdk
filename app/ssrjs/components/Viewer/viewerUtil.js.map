{"version":3,"sources":["app/jsx/components/Viewer/viewerUtil.jsx"],"names":[],"mappings":"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","file":"app/jsx/components/Viewer/viewerUtil.jsx","sourcesContent":["// Viewer Utilities\n// ================\n// A group of utility functions for the Viewer and associated content.\n\n\"use strict\";\n\nimport React from \"react\";\nimport TWBS from \"react-bootstrap\";\n\nimport Icon from \"../../components/Icon\";\n\nvar viewerUtil = exports;\n\nviewerUtil.getPastelColor = function( seed ) {\n  var r, g, b;\n\n  var h = ( ( 137.5 * seed ) % 360 ) / 360 ;\n  var s = 0.25;\n  var v = 0.65;\n\n  var i = Math.floor(h * 6);\n  var f = h * 6 - i;\n  var p = v * (1 - s);\n  var q = v * (1 - f * s);\n  var t = v * (1 - (1 - f) * s);\n\n  switch(i % 6) {\n      case 0: r = v, g = t, b = p; break;\n      case 1: r = q, g = v, b = p; break;\n      case 2: r = p, g = v, b = t; break;\n      case 3: r = p, g = q, b = v; break;\n      case 4: r = t, g = p, b = v; break;\n      case 5: r = v, g = p, b = q; break;\n  }\n\n  return [\n      Math.round( r * 255 )\n    , Math.round( g * 255 )\n    , Math.round( b * 255 )\n  ];\n};\n\nviewerUtil.markSearch = function ( fullString, searchString ) {\n  var i = 0;\n  var splitIndex = 0;\n  var searchIndex = 0;\n  var splitString = [''];\n  fullString = fullString.toString();\n  var strLower = fullString.toLowerCase();\n\n  while ( i < fullString.length ) {\n    searchIndex = i + searchString.length;\n    if ( searchIndex <= fullString.length ) {\n      // if a match is found, push it onto the splitString and continue\n      if ( strLower.substring(i, searchIndex) === searchString.toLowerCase() ) {\n        splitString.push(fullString.substring(i, searchIndex));\n        splitString.push('');\n        i = searchIndex;\n        splitIndex += 2;\n      } else {\n      // otherwise keep going we haven't found a match\n        splitString[splitIndex] += fullString[i];\n        i++;\n      }\n    } else {\n      splitString[splitIndex] += fullString[i];\n      i++;\n    }\n  }\n\n  return splitString.map( function( subString, index ) {\n    if ( subString.toLowerCase() === searchString.toLowerCase() ) {\n      return <span><mark>{ subString }</mark></span>;\n    } else {\n      return <span>{ subString }</span>;\n    }\n  });\n};\n\nviewerUtil.ItemIcon = React.createClass({\n\n    propTypes: {\n        iconImage       : React.PropTypes.string\n      , fontIcon        : React.PropTypes.string\n      , size            : React.PropTypes.number\n      , fontSize        : React.PropTypes.number\n      , primaryString   : React.PropTypes.any\n      , fallbackString  : React.PropTypes.any.isRequired\n      , seedNumber      : React.PropTypes.number\n    }\n\n  , getDefaultProps: function () {\n      return {\n          size     : null\n        , fontSize : null\n      };\n    }\n\n  , componentWillMount: function () {\n      this.setIcon( this.props );\n  }\n\n  , componentWillReceiveProps: function( nextProps ) {\n      this.setIcon( this.props );\n  }\n\n  , setIcon: function( props ) {\n      // If there's a profile picture already, don't bother with an icon.\n      if ( !props.iconImage ) {\n        // Font Icon overrides initials icon, but only needs a color.\n        if ( props.fontIcon ) {\n          this.setIconColor ( this.props );\n        } else {\n          this.setInitialsIcon( this.props );\n        }\n      }\n    }\n\n  , setInitialsIcon: function( props ) {\n      var initials = \"\";\n\n      if ( props.primaryString ) {\n        initials = props.primaryString.toString()\n                     .trim()\n                     .split(\" \")\n                     .map( function( word ) { return word[0]; } );\n      } else {\n        initials = props.fallbackString;\n      }\n\n      this.setState({\n        initials  : ( initials[0] + ( initials.length > 1 ? initials[ initials.length - 1 ] : \"\" ) ).toUpperCase()\n      });\n\n      this.setIconColor( this.props );\n    }\n\n  , setIconColor: function ( props ) {\n      var userRGB;\n\n      if ( typeof props.seedNumber === \"number\" ) {\n        userRGB = viewerUtil.getPastelColor( props.seedNumber );\n      } else {\n        userRGB = viewerUtil.getPastelColor( props.primaryString.length + props.fallbackString.length );\n      }\n\n      this.setState({\n        userColor : \"rgb(\" + userRGB.join(\",\") + \")\"\n      });\n    }\n\n  , render: function () {\n      if ( this.props.iconImage ) {\n        // TODO: BASE64 encoded user images from middleware\n        return (\n          <div className = \"icon\"\n               style     = { { height : this.props.size\n                             , width  : this.props.size } }>\n            <img className=\"image-icon\" src={ \"data:image/jpg;base64,\" + this.props.iconImage } />\n          </div>\n        );\n      } else if ( this.props.fontIcon ) {\n        // Use a Font Icon, but only if there isn't a specific image specified.\n        return (\n          <div className = \"icon\"\n               style     = { { background : this.state.userColor ? this.state.userColor : null\n                             , height     : this.props.size\n                             , width      : this.props.size } }>\n            <span className = \"font-icon\"\n                  style     = { { fontSize : this.props.fontSize + \"em\" } } >\n              <Icon glyph     = { this.props.fontIcon } />\n            </span>\n          </div>\n        );\n      } else {\n        // Using the Initials icon is a last resort.\n        return (\n          <div className = \"icon\"\n               style     = { { background : this.state.userColor ? this.state.userColor : null\n                             , height     : this.props.size\n                             , width      : this.props.size } }>\n            <span className = \"initials-icon\"\n                  style     = { { fontSize : this.props.fontSize + \"em\"} } >\n              { this.state.initials }\n            </span>\n          </div>\n        );\n      }\n    }\n\n});\n\n// Lazy helper for potentially unknown types returned from middleware\nviewerUtil.identifyAndWrite = function( entry ) {\n  switch ( typeof entry ) {\n    case \"string\":\n      return viewerUtil.writeString( entry );\n\n    case \"number\":\n      return viewerUtil.writeString( entry, \"0\" );\n\n    case \"boolean\":\n      return viewerUtil.writeBool( entry );\n\n    default:\n      return false;\n  }\n};\n\n// Return a string if it's defined and non-zero length.\nviewerUtil.writeString = function( entry, falseValue ) {\n  if ( entry ) {\n    return entry;\n  } else {\n    // Allow a choice of fallback string.\n    return falseValue ? falseValue : \"--\";\n  }\n};\n\n// Return a check mark if true, X mark if false.\nviewerUtil.writeBool = function( entry ) {\n  if ( entry ) {\n    return (\n      <Icon className = \"text-primary\"\n            glyph     = \"check\" />\n    );\n  } else {\n    return (\n      <Icon className = \"text-muted\"\n             glyph    = \"times\" />\n    );\n  }\n};\n\n// A simple data cell whose title is a string, and whose value is represented\n// based on its type (eg. check mark for boolean). colNum is used to scale the\n// output to the number of columns desired. Only 2, 3, and 4 should be used.\n// On small screens, the number of columns is always 2.\nviewerUtil.DataCell = React.createClass({\n    propTypes: {\n        title  : React.PropTypes.string.isRequired\n      , colNum : React.PropTypes.number.isRequired\n      , entry  : React.PropTypes.oneOfType([\n            React.PropTypes.string\n          , React.PropTypes.bool\n          , React.PropTypes.number\n        ]).isRequired\n    }\n  , render: function () {\n      if ( typeof this.props.entry !== \"undefined\" ) {\n        return (\n          <TWBS.Col className=\"text-center\"\n                    xs={6} sm={12/this.props.colNum}>\n            <h4 className=\"text-muted\">{ this.props.title }</h4>\n            <h4>{ viewerUtil.identifyAndWrite( this.props.entry ) }</h4>\n          </TWBS.Col>\n        );\n      } else {\n        return null;\n      }\n    }\n});\n"]}