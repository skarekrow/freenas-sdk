{"version":3,"sources":["app/jsx/components/Viewer/TableViewer.jsx"],"names":[],"mappings":"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","file":"app/jsx/components/Viewer/TableViewer.jsx","sourcesContent":["\n\n\"use strict\";\n\nimport React from \"react\";\nimport _ from \"lodash\";\nimport TWBS from \"react-bootstrap\";\n\nimport { Link, RouteHandler } from \"react-router\";\n\nimport Icon from \"../Icon\";\n\nimport viewerCommon from \"../mixins/viewerCommon\";\nimport viewerUtil from \"./viewerUtil\";\n\n// Table Viewer\nvar TableViewer = React.createClass({\n\n    mixins: [ viewerCommon ]\n\n  , contextTypes: {\n      router: React.PropTypes.func\n    }\n\n  , propTypes: {\n        viewData         : React.PropTypes.object.isRequired\n      , inputData        : React.PropTypes.array.isRequired\n      , handleItemSelect : React.PropTypes.func.isRequired\n      , selectedItem     : React.PropTypes.oneOfType([ React.PropTypes.number, React.PropTypes.string ])\n      , searchString     : React.PropTypes.string\n      , filteredData     : React.PropTypes.object.isRequired\n      , tableCols        : React.PropTypes.array.isRequired\n    }\n\n  , getInitialState: function () {\n      return {\n          tableColWidths : this.getInitialColWidths( this.props.tableCols )\n        , tableColOrder  : this.props.tableCols\n        , sortTableBy    : null\n        , sortOrder      : \"none\"\n      };\n    }\n\n  , componentDidMount: function () {\n      this.setState({ tableColWidths: this.getUpdatedColWidths( this.state.tableColOrder ) });\n      window.addEventListener( \"keyup\", this.handleEscClose );\n    }\n\n  , componentWillUnmount: function () {\n      window.removeEventListener( \"keyup\", this.handleEscClose );\n    }\n\n  , handleEscClose: function( event ) {\n      if ( event.which === 27 && this.dynamicPathIsActive() ) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.returnToViewerRoot();\n      }\n    }\n\n  , handleClickOut: function( event, componentID ) {\n      if ( event.dispatchMarker === componentID ) {\n        this.returnToViewerRoot();\n      }\n    }\n\n  , handleRowClick: function( params, selectionValue, event, componentID ) {\n      switch ( event.type ) {\n        case \"click\":\n          this.props.handleItemSelect( selectionValue );\n          break;\n\n        case \"dblclick\":\n          this.context.router.transitionTo( this.props.viewData.routing.route, params );\n          break;\n      }\n    }\n\n  , changeSortState: function( key, event ) {\n      var nextSortTableBy = key;\n      var nextSortOrder;\n\n      // When the next key matches the current selection, change the sort order\n      if ( this.state.sortTableBy === key ) {\n        switch ( this.state.sortOrder ) {\n          case \"none\":\n            nextSortOrder = \"descending\";\n            break;\n\n          case \"descending\":\n            nextSortOrder = \"ascending\";\n            break;\n\n          // If the user has clicked three times on the same header, clear the\n          // sort and \"reset\" the view\n          case \"ascending\":\n            nextSortTableBy = null;\n            nextSortOrder   = \"none\";\n            break;\n        }\n      } else {\n        nextSortOrder = \"descending\";\n      }\n\n      this.setState({\n          sortTableBy : nextSortTableBy\n        , sortOrder   : nextSortOrder\n      });\n\n    }\n\n  , getInitialColWidths: function( colArray ) {\n      var tempWidths = {};\n\n      colArray.map( function( targetCol, index ) {\n        tempWidths[ targetCol ] = \"auto\";\n      });\n\n      return tempWidths;\n    }\n\n  , getUpdatedColWidths: function( colArray ) {\n      var tempWidths  = {};\n      var viewerRefs  = this.refs;\n      var viewerWidth = this.refs[ \"TABLE_VIEWER\" ].getDOMNode().offsetWidth;\n\n      colArray.map( function( targetCol, index ) {\n        var colWidth = viewerRefs[ \"COL_\" + targetCol ].getDOMNode().offsetWidth;\n        tempWidths[ targetCol ] = Math.round( colWidth / viewerWidth * 10000 ) / 100 + \"%\";\n      });\n\n      return tempWidths;\n    }\n\n  , createHeader: function( key, index ) {\n      var thIsActive  = ( this.state.sortTableBy === key );\n      var targetEntry = _.where( this.props.viewData.format[\"dataKeys\"], { \"key\" : key })[0];\n      return(\n        <th className     = \"fixed-table-header-th\"\n            ref           = { \"COL_\" + key }\n            style         = {{ width: this.state.tableColWidths[ key ] }}\n            key           = { index } >\n          <span className=\"th-spacing\">\n            { targetEntry[\"name\"] }\n          </span>\n          <div className = { \"th-content sortable-table-th\" + ( thIsActive ? \" \" + this.state.sortOrder : \"\" ) }\n               onClick   = { this.changeSortState.bind( null, key ) } >\n            { targetEntry[\"name\"] }\n          </div>\n        </th>\n      );\n    }\n\n  , createRows: function( item, index ) {\n      var selectionValue = item[ this.props.viewData.format[\"selectionKey\"] ];\n      var params         = {};\n\n      params[ this.props.viewData.routing[\"param\"] ] = selectionValue;\n\n      return(\n        <tr\n          key           = { index }\n          className     = { this.props.selectedItem === selectionValue ? \"active\" : \"\" }\n          onClick       = { this.handleRowClick.bind( null, null, selectionValue ) }\n          onDoubleClick = { this.handleRowClick.bind( null, params, selectionValue ) } >\n          { this.props.tableCols.map( function( key, index ) {\n              return ( <td key={ index }>{ viewerUtil.identifyAndWrite( item[ key ] ) }</td> );\n            })\n          }\n        </tr>\n      );\n    }\n\n  , render: function () {\n\n    var tableData     = null;\n    var editorContent = null;\n\n    if ( this.dynamicPathIsActive() ) {\n      editorContent = (\n        <div className = \"overlay-light editor-edit-overlay\"\n             onClick   = { this.handleClickOut } >\n          <div className=\"editor-edit-wrapper\">\n            <span className=\"clearfix\">\n              <Icon\n                glyph    = \"close\"\n                icoClass = \"editor-close\"\n                onClick  = { this.handleClickOut } />\n            </span>\n            <RouteHandler\n              viewData  = { this.props.viewData }\n              inputData = { this.props.inputData }\n              activeKey = { this.props.selectedKey } />\n          </div>\n        </div>\n      );\n    }\n\n    if ( this.state.sortTableBy ) {\n      tableData = _.sortBy( this.props.filteredData[\"rawList\"], this.state.sortTableBy );\n\n      if ( this.state.sortOrder === \"ascending\" ) {\n        tableData = tableData.reverse();\n      }\n\n    } else {\n      tableData = this.props.filteredData[\"rawList\"];\n    }\n\n    return(\n      <div className = \"viewer-table fixed-table-container\">\n        { editorContent }\n        <div className = \"fixed-table-container-inner\">\n\n          <TWBS.Table striped bordered condensed hover\n                      ref       = \"TABLE_VIEWER\"\n                      className = \"fixed-table\">\n\n            <thead>\n              <tr>\n                { this.props.tableCols.map( this.createHeader ) }\n              </tr>\n            </thead>\n\n            <tbody>\n              { tableData.map( this.createRows ) }\n            </tbody>\n\n          </TWBS.Table>\n        </div>\n      </div>\n    );\n  }\n\n});\n\nmodule.exports = TableViewer;\n"]}